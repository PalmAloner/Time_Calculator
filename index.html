<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£ Police Highway</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #4c1d95;
            margin-bottom: 10px;
            font-size: 2em;
        }

        h2 {
            color: #4c1d95;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .info {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        input {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .add-btn {
            align-self: flex-end;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #f3f4f6;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4c1d95;
            font-size: 0.9em;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        tr:hover {
            background: #f9fafb;
        }

        tr.received {
            background: #d1fae5;
        }

        tr.received:hover {
            background: #a7f3d0;
        }

        .box-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            display: inline-block;
        }

        .delete-btn {
            background: #ef4444;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
        }

        .summary h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            color: white;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 2.5em;
            font-weight: 700;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 10px 5px;
            }

            .summary-value {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£ Police Highway</h1>
            <div class="info">
                ‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©:<br>
                ‚Ä¢ 20:30-00:00 ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö = 30 ‡∏Å‡∏•‡πà‡∏≠‡∏á | ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö = 1 ‡∏ä‡∏°.‡πÄ‡∏ï‡πá‡∏° = 6 ‡∏Å‡∏•‡πà‡∏≠‡∏á<br>
                ‚Ä¢ 00:00-03:00 ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö = 20 ‡∏Å‡∏•‡πà‡∏≠‡∏á | ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö = 1 ‡∏ä‡∏°.‡πÄ‡∏ï‡πá‡∏° = 6 ‡∏Å‡∏•‡πà‡∏≠‡∏á<br>
                ‚Ä¢ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏ó ¬± 30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏¢‡∏±‡∏á‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö<br>
                ‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏© = ‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                    <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">
                </div>
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="date">
                </div>
                <div class="form-group">
                    <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° (‡πÄ‡∏ä‡πà‡∏ô 20.30)</label>
                    <input type="text" id="startTime" placeholder="20.30">
                </div>
                <div class="form-group">
                    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡πÄ‡∏ä‡πà‡∏ô 03.00)</label>
                    <input type="text" id="endTime" placeholder="03.00">
                </div>
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="text" id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button class="add-btn" onclick="addEntry()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
            </div>
        </div>

        <div class="card" id="entriesCard" style="display: none;">
            <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏£‡∏ß‡∏°</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</th>
                            <th class="text-center">‡∏Å‡∏•‡πà‡∏≠‡∏á</th>
                            <th class="text-center">‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</th>
                            <th class="text-center">‡∏•‡∏ö</th>
                        </tr>
                    </thead>
                    <tbody id="entriesTable">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card" id="summaryByNameCard" style="display: none;">
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö)</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏£‡∏ß‡∏°</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</th>
                            <th class="text-center">‡∏Å‡∏•‡πà‡∏≠‡∏á</th>
                        </tr>
                    </thead>
                    <tbody id="summaryByNameTable">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card" id="summaryReceivedCard" style="display: none;">
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß)</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏£‡∏ß‡∏°</th>
                            <th class="text-center">‡∏ä‡∏°.‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody id="summaryReceivedTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        var entries = [];

        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyXwhD01IUNfOkwkUraWzq5z239E2hzzdPjzqS3_kakxr74-n-Tr0LZRF3fFQKrJcRyEA/exec";
        const API_KEY = "PALM_SECRET_123";

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Drive ‡πÅ‡∏•‡∏∞ localStorage
        async function loadData() {
            try {
                // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Drive ‡∏Å‡πà‡∏≠‡∏ô
                const driveData = await loadFromGoogleDrive();
                
                if (driveData && driveData.length > 0) {
                    // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Drive = ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á Drive
                    entries = driveData;
                    localStorage.setItem('workEntries', JSON.stringify(entries));
                    console.log('‚úÖ Loaded from Google Drive:', entries.length, 'entries');
                } else {
                    // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô Drive = ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
                    var saved = localStorage.getItem('workEntries');
                    if (saved) {
                        entries = JSON.parse(saved);
                        console.log('üì¶ Loaded from localStorage:', entries.length, 'entries');
                        
                        // ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏Ç‡∏∂‡πâ‡∏ô Google Drive
                        if (entries.length > 0) {
                            console.log('‚¨ÜÔ∏è Uploading localStorage data to Google Drive...');
                            await saveToGoogleDrive();
                        }
                    } else {
                        console.log('‚ÑπÔ∏è No data found');
                    }
                }
                
                renderEntries();
                updateSummary();
            } catch (e) {
                console.error('‚ùå Error loading data:', e);
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î error ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
                try {
                    var saved = localStorage.getItem('workEntries');
                    if (saved) {
                        entries = JSON.parse(saved);
                        renderEntries();
                        updateSummary();
                    }
                } catch (e2) {
                    console.error('‚ùå Error loading from localStorage:', e2);
                }
            }
        }

        async function loadFromGoogleDrive() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?key=' + API_KEY, {
                    method: "GET"
                });
                
                const result = await response.json();
                
                if (result.status === "success" && result.data) {
                    return result.data;
                }
                
                return null;
            } catch (err) {
                console.error("Error loading from Google Drive:", err);
                return null;
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage ‡πÅ‡∏•‡∏∞ Google Drive
        async function saveData() {
            try {
                localStorage.setItem('workEntries', JSON.stringify(entries));
                await saveToGoogleDrive();
            } catch (e) {
                console.error('Error saving data:', e);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }

        async function saveToGoogleDrive() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        key: API_KEY,
                        data: entries
                    })
                });
                
                console.log('Data saved to Google Drive successfully');
            } catch (err) {
                console.error("Error saving to Google Drive:", err);
            }
        }

        function parseTime(timeStr) {
            timeStr = timeStr.trim().replace('.', ':');
            
            var parts = timeStr.split(':');
            if (parts.length !== 2) {
                return null;
            }
            
            var hour = parseInt(parts[0]);
            var min = parseInt(parts[1]);
            
            if (isNaN(hour) || isNaN(min) || hour < 0 || hour > 23 || min < 0 || min > 59) {
                return null;
            }
            
            return hour + ':' + (min < 10 ? '0' + min : min);
        }

        function calculateBoxes(start, end) {
            var timeStart = start.split(':');
            var startHour = parseInt(timeStart[0]);
            var startMin = parseInt(timeStart[1]);
            
            var timeEnd = end.split(':');
            var endHour = parseInt(timeEnd[0]);
            var endMin = parseInt(timeEnd[1]);
            
            var startMinutes = startHour * 60 + startMin;
            var endMinutes = endHour * 60 + endMin;
            
            if (endMinutes <= startMinutes) {
                endMinutes = endMinutes + 24 * 60;
            }
            
            var totalMinutes = endMinutes - startMinutes;
            var totalHours = Math.floor(totalMinutes / 60); // ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
            
            var shift1Start = 20.5 * 60;  // 20:30 = 1230 ‡∏ô‡∏≤‡∏ó‡∏µ
            var shift1End = 24 * 60;       // 24:00 = 1440 ‡∏ô‡∏≤‡∏ó‡∏µ
            var shift2Start = 0;           // 00:00 = 0 ‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
            var shift2End = 3 * 60;        // 03:00 = 180 ‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
            
            var tolerance = 30;
            
            var shift1Minutes = 0;
            var shift2Minutes = 0;
            var regularMinutes = 0;
            
            // ‡∏ô‡∏±‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏≤‡∏ó‡∏µ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô
            for (var m = startMinutes; m < endMinutes; m++) {
                var currentMin = m % (24 * 60);
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 20:30-24:00
                if (currentMin >= shift1Start && currentMin < shift1End) {
                    shift1Minutes++;
                }
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 00:00-03:00
                else if (currentMin >= shift2Start && currentMin < shift2End) {
                    shift2Minutes++;
                }
                // ‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©
                else {
                    regularMinutes++;
                }
            }
            
            var shift1FullMinutes = 210;  // 3.5 ‡∏ä‡∏°. = 210 ‡∏ô‡∏≤‡∏ó‡∏µ
            var shift2FullMinutes = 180;  // 3 ‡∏ä‡∏°. = 180 ‡∏ô‡∏≤‡∏ó‡∏µ
            
            var boxes = 0;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 1 (20:30-24:00)
            if (shift1Minutes >= shift1FullMinutes - tolerance) {
                boxes = boxes + 30;
            } else {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: 6 ‡∏Å‡∏•‡πà‡∏≠‡∏á/‡∏ä‡∏°. = (‡∏ô‡∏≤‡∏ó‡∏µ / 60) √ó 6
                var shift1Hours = Math.floor(shift1Minutes / 60); // ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                boxes = boxes + (shift1Hours * 6);
            }
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 2 (00:00-03:00)
            if (shift2Minutes >= shift2FullMinutes - tolerance) {
                boxes = boxes + 20;
            } else {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: 6 ‡∏Å‡∏•‡πà‡∏≠‡∏á/‡∏ä‡∏°. = (‡∏ô‡∏≤‡∏ó‡∏µ / 60) √ó 6
                var shift2Hours = Math.floor(shift2Minutes / 60); // ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                boxes = boxes + (shift2Hours * 6);
            }
            
            var regularHours = Math.floor(regularMinutes / 60); // ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
            
            return {
                totalHours: totalHours,
                boxes: boxes,
                regularHours: regularHours
            };
        }

        function addEntry() {
            var name = document.getElementById('name').value;
            var date = document.getElementById('date').value;
            var startTimeInput = document.getElementById('startTime').value;
            var endTimeInput = document.getElementById('endTime').value;
            var note = document.getElementById('note').value;

            if (!name || !date || !startTimeInput || !endTimeInput) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            var startTime = parseTime(startTimeInput);
            var endTime = parseTime(endTimeInput);
            
            if (!startTime || !endTime) {
                alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô 20.30 ‡∏´‡∏£‡∏∑‡∏≠ 20:30');
                return;
            }

            var result = calculateBoxes(startTime, endTime);
            
            var newEntry = {
                id: Date.now(),
                name: name,
                date: date,
                startTime: startTime,
                endTime: endTime,
                note: note || '',
                totalHours: result.totalHours,
                boxes: result.boxes,
                regularHours: result.regularHours,
                received: false
            };

            entries.push(newEntry);
            
            document.getElementById('name').value = '';
            document.getElementById('date').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
            document.getElementById('note').value = '';
            
            saveData();
            renderEntries();
            updateSummary();
        }

        function deleteEntry(id) {
            var newEntries = [];
            for (var i = 0; i < entries.length; i++) {
                if (entries[i].id !== id) {
                    newEntries.push(entries[i]);
                }
            }
            entries = newEntries;
            saveData();
            renderEntries();
            updateSummary();
        }

        function toggleReceived(id) {
            for (var i = 0; i < entries.length; i++) {
                if (entries[i].id === id) {
                    entries[i].received = !entries[i].received;
                    break;
                }
            }
            saveData();
            renderEntries();
            updateSummary();
        }

        function renderEntries() {
            var tbody = document.getElementById('entriesTable');
            var entriesCard = document.getElementById('entriesCard');
            
            if (entries.length === 0) {
                entriesCard.style.display = 'none';
                return;
            }
            
            entriesCard.style.display = 'block';
            
            var html = '';
            for (var i = 0; i < entries.length; i++) {
                var entry = entries[i];
                html = html + '<tr class="' + (entry.received ? 'received' : '') + '">';
                html = html + '<td style="font-weight: 600;">' + entry.name + '</td>';
                html = html + '<td>' + entry.date + '</td>';
                html = html + '<td>' + entry.startTime + ' - ' + entry.endTime + '</td>';
                html = html + '<td style="color: #6b7280; font-size: 0.9em;">' + (entry.note || '-') + '</td>';
                html = html + '<td class="text-center" style="font-weight: 600;">' + entry.totalHours + '</td>';
                html = html + '<td class="text-center" style="color: #6b7280; font-weight: 600;">' + entry.regularHours + '</td>';
                html = html + '<td class="text-center"><span class="box-badge">' + entry.boxes + '</span></td>';
                html = html + '<td class="text-center"><input type="checkbox" class="checkbox" ' + (entry.received ? 'checked' : '') + ' onchange="toggleReceived(' + entry.id + ')"></td>';
                html = html + '<td class="text-center"><button class="delete-btn" onclick="deleteEntry(' + entry.id + ')">‡∏•‡∏ö</button></td>';
                html = html + '</tr>';
            }
            
            tbody.innerHTML = html;
        }

        function updateSummary() {
            var summaryByNameCard = document.getElementById('summaryByNameCard');
            var summaryReceivedCard = document.getElementById('summaryReceivedCard');
            
            if (entries.length === 0) {
                summaryByNameCard.style.display = 'none';
                summaryReceivedCard.style.display = 'none';
                return;
            }
            
            // ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö)
            var summaryByName = {};
            
            // ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ (‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß)
            var summaryReceived = {};
            
            for (var i = 0; i < entries.length; i++) {
                var entry = entries[i];
                var name = entry.name;
                
                if (entry.received) {
                    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß
                    if (!summaryReceived[name]) {
                        summaryReceived[name] = {
                            count: 0,
                            totalHours: 0,
                            regularHours: 0
                        };
                    }
                    
                    summaryReceived[name].count = summaryReceived[name].count + 1;
                    summaryReceived[name].totalHours = summaryReceived[name].totalHours + entry.totalHours;
                    summaryReceived[name].regularHours = summaryReceived[name].regularHours + entry.regularHours;
                } else {
                    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
                    if (!summaryByName[name]) {
                        summaryByName[name] = {
                            count: 0,
                            totalHours: 0,
                            regularHours: 0,
                            boxes: 0
                        };
                    }
                    
                    summaryByName[name].count = summaryByName[name].count + 1;
                    summaryByName[name].totalHours = summaryByName[name].totalHours + entry.totalHours;
                    summaryByName[name].regularHours = summaryByName[name].regularHours + entry.regularHours;
                    summaryByName[name].boxes = summaryByName[name].boxes + entry.boxes;
                }
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
            var names = [];
            for (var name in summaryByName) {
                names.push(name);
            }
            
            if (names.length > 0) {
                summaryByNameCard.style.display = 'block';
                
                var tbody = document.getElementById('summaryByNameTable');
                var html = '';
                
                for (var i = 0; i < names.length; i++) {
                    var name = names[i];
                    var data = summaryByName[name];
                    
                    html = html + '<tr>';
                    html = html + '<td style="font-weight: 600;">' + name + '</td>';
                    html = html + '<td class="text-center" style="font-weight: 600;">' + data.count + '</td>';
                    html = html + '<td class="text-center" style="font-weight: 600;">' + data.totalHours + '</td>';
                    html = html + '<td class="text-center" style="color: #6b7280; font-weight: 600;">' + data.regularHours + '</td>';
                    html = html + '<td class="text-center"><span class="box-badge">' + data.boxes + '</span></td>';
                    html = html + '</tr>';
                }
                
                tbody.innerHTML = html;
            } else {
                summaryByNameCard.style.display = 'none';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß
            var receivedNames = [];
            for (var name in summaryReceived) {
                receivedNames.push(name);
            }
            
            if (receivedNames.length > 0) {
                summaryReceivedCard.style.display = 'block';
                
                var tbody2 = document.getElementById('summaryReceivedTable');
                var html2 = '';
                
                for (var i = 0; i < receivedNames.length; i++) {
                    var name = receivedNames[i];
                    var data = summaryReceived[name];
                    
                    html2 = html2 + '<tr>';
                    html2 = html2 + '<td style="font-weight: 600;">' + name + '</td>';
                    html2 = html2 + '<td class="text-center" style="font-weight: 600;">' + data.count + '</td>';
                    html2 = html2 + '<td class="text-center" style="font-weight: 600;">' + data.totalHours + '</td>';
                    html2 = html2 + '<td class="text-center" style="color: #6b7280; font-weight: 600;">' + data.regularHours + '</td>';
                    html2 = html2 + '</tr>';
                }
                
                tbody2.innerHTML = html2;
            } else {
                summaryReceivedCard.style.display = 'none';
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
